{"version":3,"sources":["../../../../../assets/scripts/component/assets/scripts/component/CreateTower.js"],"names":["cc","Class","extends","Component","properties","newTowerToggle","default","undefined","type","ToggleContainer","gameRoot","require","ctor","CC_EDITOR","globalEvent","on","createTower","updateResult","curPassData","passData","getCurPassData","onLoad","onDestroy","off","node","active","gameResult","event","isMouseMove","detail","entityFloor","onDisable","yesCreate","towerToggle","utils","getToggleCheckNode","towerInfo","configData","getTower_Level1_Info","name","tip","buildCost","gameData","gold","changeGold","entityMgr","createEntity","x","y","idx","clearEntity","noCreate"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAAQF,GAAGG,SADN;AAELC,gBAAW;AACPC,wBAAe;AACXC,qBAAQC,SADG;AAEXC,kBAAKR,GAAGS;AAFG,SADR;AAKPC,kBAAS;AACLJ,qBAAQC,SADH;AAELC,kBAAKG,QAAQ,UAAR;AAFA;AALF,KAFN;AAYLC,QAZK,kBAYC;AACF,YAAG,CAACC,SAAJ,EAAc;AACVb,eAAGc,WAAH,CAAeC,EAAf,CAAkB,kBAAlB,EAAqC,KAAKC,WAA1C,EAAsD,IAAtD;AACAhB,eAAGc,WAAH,CAAeC,EAAf,CAAkB,sBAAlB,EAAyC,KAAKE,YAA9C,EAA2D,IAA3D;AACA,iBAAKC,WAAL,GAAmBlB,GAAGmB,QAAH,CAAYC,cAAZ,EAAnB;AACH;AACJ,KAlBI;AAmBLC,UAnBK,oBAmBG,CAEP,CArBI;AAsBLC,aAtBK,uBAsBM;AACPtB,WAAGc,WAAH,CAAeS,GAAf,CAAmB,kBAAnB,EAAsC,KAAKP,WAA3C,EAAuD,IAAvD;AACAhB,WAAGc,WAAH,CAAeS,GAAf,CAAmB,sBAAnB,EAA0C,KAAKN,YAA/C,EAA4D,IAA5D;AACH,KAzBI;AA0BLA,gBA1BK,0BA0BS;AACV,aAAKO,IAAL,CAAUC,MAAV,GAAoB,KAAKP,WAAL,CAAiBQ,UAAjB,IAA6BnB,SAAjD;AACH,KA5BI;AA6BLS,eA7BK,uBA6BOW,KA7BP,EA6Ba;AACd,YAAG,KAAKjB,QAAL,CAAckB,WAAjB,EAA6B;AAC7B,aAAKJ,IAAL,CAAUC,MAAV,GAAmB,IAAnB;AACA,YAAII,SAASF,MAAME,MAAnB;AACA,aAAKC,WAAL,GAAmBD,MAAnB;AACH,KAlCI;AAmCLE,aAnCK,uBAmCM;AACP,aAAKD,WAAL,GAAmBvB,SAAnB;AACH,KArCI;AAsCLyB,aAtCK,uBAsCM;AACP,YAAIC,cAAcjC,GAAGkC,KAAH,CAASC,kBAAT,CAA4B,KAAK9B,cAAjC,CAAlB;AACA,YAAG4B,WAAH,EAAe;AACX,gBAAIG,YAAYpC,GAAGqC,UAAH,CAAcC,oBAAd,CAAmCL,YAAYM,IAA/C,CAAhB;AACA,gBAAG,CAACH,SAAJ,EAAc;AACVpC,mBAAGkC,KAAH,CAASM,GAAT,CAAa,oBAAb;AACA;AACH;AACD,gBAAG,CAACJ,UAAUK,SAAX,GAAuB,KAAKvB,WAAL,CAAiBwB,QAAjB,CAA0BC,IAApD,EAAyD;AACrD3C,mBAAGkC,KAAH,CAASM,GAAT,CAAa,oBAAb;AACA;AACH;AACD,iBAAKtB,WAAL,CAAiB0B,UAAjB,CAA4BR,UAAUK,SAAtC;AACAzC,eAAG6C,SAAH,CAAaC,YAAb,CAA0Bb,YAAYM,IAAtC,EACI,KAAKT,WAAL,CAAiBiB,CADrB,EAEI,KAAKjB,WAAL,CAAiBkB,CAFrB,EAGIZ,UAAUa,GAHd;AAIAjD,eAAG6C,SAAH,CAAaK,WAAb,CAAyB,KAAKpB,WAA9B;AACH,SAhBD,MAgBK;AACD9B,eAAGkC,KAAH,CAASM,GAAT,CAAa,4BAAb;AACA;AACH;AACD,aAAKhB,IAAL,CAAUC,MAAV,GAAmB,KAAnB;AACH,KA7DI;AA8DL0B,YA9DK,sBA8DK;AACN,aAAK3B,IAAL,CAAUC,MAAV,GAAmB,KAAnB;AACH;AAhEI,CAAT","file":"CreateTower.js","sourceRoot":"../../../../../assets/scripts/component","sourcesContent":["cc.Class({\n    extends:cc.Component,\n    properties:{\n        newTowerToggle:{\n            default:undefined,\n            type:cc.ToggleContainer,\n        },\n        gameRoot:{\n            default:undefined,\n            type:require(\"GameRoot\"),\n        }\n    },\n    ctor(){\n        if(!CC_EDITOR){\n            cc.globalEvent.on(\"Game:createTower\",this.createTower,this);\n            cc.globalEvent.on(\"CurData:updateResult\",this.updateResult,this);\n            this.curPassData = cc.passData.getCurPassData();\n        }\n    },\n    onLoad(){\n\n    },\n    onDestroy(){\n        cc.globalEvent.off(\"Game:createTower\",this.createTower,this);\n        cc.globalEvent.off(\"CurData:updateResult\",this.updateResult,this);\n    },\n    updateResult(){\n        this.node.active = (this.curPassData.gameResult==undefined);\n    },\n    createTower(event){\n        if(this.gameRoot.isMouseMove)return;\n        this.node.active = true;\n        var detail = event.detail;\n        this.entityFloor = detail;\n    },\n    onDisable(){\n        this.entityFloor = undefined;\n    },\n    yesCreate(){\n        var towerToggle = cc.utils.getToggleCheckNode(this.newTowerToggle);\n        if(towerToggle){\n            var towerInfo = cc.configData.getTower_Level1_Info(towerToggle.name);\n            if(!towerInfo){\n                cc.utils.tip(\"tower is not exist\");\n                return;\n            }\n            if(-towerInfo.buildCost > this.curPassData.gameData.gold){\n                cc.utils.tip(\"gold is not enough\");\n                return;\n            }\n            this.curPassData.changeGold(towerInfo.buildCost);\n            cc.entityMgr.createEntity(towerToggle.name,\n                this.entityFloor.x,\n                this.entityFloor.y,\n                towerInfo.idx);\n            cc.entityMgr.clearEntity(this.entityFloor);\n        }else{\n            cc.utils.tip(\"please select a tower type\");\n            return;\n        }\n        this.node.active = false;\n    },\n    noCreate(){\n        this.node.active = false;\n    },\n})"]}