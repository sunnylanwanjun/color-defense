{"version":3,"sources":["../../../../../assets/scripts/ctrl/assets/scripts/ctrl/GameCtrl.js"],"names":["nop","cc","Class","ctor","playADTimes","playPassAD","callback","gameConfig","adPlayInterval","log","window","hasOwnProperty","utils","openLoading","ad","placement_id","adPassCode_FB","FBInstant","getInterstitialAdAsync","then","interstitial","loadAsync","showAsync","closeLoading","bind","catch","err","message","addItem","curPassData","passData","getCurPassData","itemArr","adConfig","giftItemArr","key","itemInfo","itemType","itemNum","playItemAD","adItemCode_FB","getRewardedVideoAsync","rewardedVideo","invite","context","chooseAsync","getID","share","shareAsync","intent","image","shareBase64Img","text","needShowRecommend","recommendGame_FB","length","requestRecommend","idx","recommendConfig","switchGameAsync","code"],"mappings":"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","file":"GameCtrl.js","sourceRoot":"../../../../../assets/scripts/ctrl","sourcesContent":["var nop = function(){\n    \n}\n\ncc.Class({\n    ctor(){\n        this.playADTimes = 0;\n    },\n    playPassAD(callback){\n        callback = callback || nop;\n\n        if(this.playADTimes<cc.gameConfig.adPlayInterval){\n            cc.log(\"GameCtrl:playPassAD\",this.playADTimes,cc.gameConfig.adPlayInterval);\n            this.playADTimes++;\n            return;\n        }\n        this.playADTimes=0;\n\n        if(window&&window.hasOwnProperty(\"FBInstant\")){\n            cc.utils.openLoading();\n            var ad = null;\n            var placement_id = cc.gameConfig.adPassCode_FB;\n            cc.log(\"GameCtrl:playPassAD placement_id\",placement_id);\n            FBInstant.getInterstitialAdAsync(\n                placement_id,\n            ).then(function(interstitial) {\n                ad = interstitial;\n                return ad.loadAsync();\n            }).then(function() {\n                // Ad loaded\n                return ad.showAsync();\n            }).then(function() {\n                // Ad watched\n                cc.utils.closeLoading();\n                cc.log(\"GameCtrl:playPassAD success\");\n                callback(true);\n            }.bind(this)).catch(function(err){\n                cc.utils.closeLoading();\n                cc.log(\"GameCtrl:playPassAD failure\",err.message);\n                callback(false);\n            });\n            return;\n        }\n        cc.log(\"GameCtrl:playItemAD can not play pass ad\");\n        callback(false);\n    },\n    addItem(){\n        var curPassData = cc.passData.getCurPassData();\n        var itemArr = cc.adConfig.giftItemArr;\n        for(var key in itemArr){\n            var itemInfo = itemArr[key];\n            curPassData.addItem(itemInfo.itemType,itemInfo.itemNum);\n        }\n    },\n    playItemAD(callback){\n        callback = callback || nop;\n        if(window&&window.hasOwnProperty(\"FBInstant\")){\n            cc.utils.openLoading();\n            var ad = null;\n            var placement_id = cc.gameConfig.adItemCode_FB;\n            cc.log(\"GameCtrl:playPassAD placement_id\",placement_id);\n            FBInstant.getRewardedVideoAsync(\n                placement_id,\n            ).then(function(rewardedVideo) {\n                ad = rewardedVideo;\n                return ad.loadAsync();\n            }).then(function() {\n                // Ad loaded\n                return ad.showAsync();\n            }).then(function() {\n                // Ad watched\n                this.addItem();\n                cc.utils.closeLoading();\n                cc.log(\"GameCtrl:playItemAD success\");\n                callback(true);\n            }.bind(this)).catch(function(err){\n                cc.utils.closeLoading();\n                cc.log(\"GameCtrl:playItemAD failure\",err.message);\n                callback(false);\n            });\n            return;\n        }\n        cc.log(\"GameCtrl:playItemAD can not play ad to get items\");\n        callback(false);\n    },\n    invite(callback){\n        callback = callback || nop;\n        if(window&&window.hasOwnProperty(\"FBInstant\")){\n            cc.utils.openLoading();\n\n            FBInstant.context\n            .chooseAsync()\n            .then(function() {\n                cc.utils.closeLoading();\n                cc.log(\"GameCtrl:invite success\",FBInstant.context.getID());\n                callback(true);\n            }).catch(function(err){\n                cc.utils.closeLoading();\n                cc.log(\"GameCtrl:invite failure\",err.message);\n                callback(false);\n            });\n            return;\n        }\n        cc.log(\"GameCtrl:invite can not invite\");\n        callback(false)\n    },\n    share(callback){\n        callback = callback || nop;\n        if(window&&window.hasOwnProperty(\"FBInstant\")){\n            cc.utils.openLoading();\n            FBInstant.shareAsync({\n                intent: 'SHARE',\n                image: cc.gameConfig.shareBase64Img,\n                text: \"come on guys,let's protect water melon together\",\n                //data: { myReplayData: '...' },\n            }).then(function() {\n                cc.utils.closeLoading();\n                cc.log(\"GameCtrl:share success\");\n                callback(true);\n            }).catch(function(err){\n                cc.utils.closeLoading();\n                cc.log(\"GameCtrl:share failure\",err.message);\n                callback(false);\n            });\n            return;\n        }\n        cc.log(\"GameCtrl:share can not share\");\n        callback(false)\n    },\n    needShowRecommend(){\n        if(window&&window.hasOwnProperty(\"FBInstant\")){\n            return cc.gameConfig.recommendGame_FB.length>0;\n        }\n        return false;\n    },\n    requestRecommend(idx,callback){\n        callback = callback || nop;\n        if(window&&window.hasOwnProperty(\"FBInstant\")){\n            var recommendConfig = cc.gameConfig.recommendGame_FB[idx];\n            if(!recommendConfig){\n                callback(false);\n                return;\n            }\n\n            cc.utils.openLoading();\n            FBInstant.switchGameAsync(recommendConfig.code).catch(function (err) {\n                cc.utils.closeLoading();\n                cc.log(\"GameCtrl:share failure\",err.message,recommendConfig);\n                callback(false);\n            });\n            return;\n        }\n        cc.log(\"GameCtrl:requestRecommend can not recommend\");\n        callback(false);\n    }\n});"]}