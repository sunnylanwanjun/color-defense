{"version":3,"sources":["../../../../../assets/scripts/node/assets/scripts/node/AniFrameNode.js"],"names":["cc","Class","extends","require","_onPreDestroy","_super","ctor","sp","addComponent","Sprite","skinInfoStr","undefined","atlas","updateAtlas","setCompleteCallback","callback","completeCallback","setColor","colorStr","color","utils","resetSkinData","name","x","y","anchorX","anchorY","rotation","scale","autoDestroy","playCount","playTime","interval","zIndex","resetAniData","curFrameIdx","goTime","playCountVar","playTimeVar","updateInfo","skinInfo","JSON","stringify","findName","resMgr","getRes","resName","skins","skinsArr","split","length","error","skinsPrefix","framesLen","parseInt","frames","i","spFrame","getSpriteFrame","push","spriteFrame","update","dt","destroy","active","bind"],"mappings":"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","file":"AniFrameNode.js","sourceRoot":"../../../../../assets/scripts/node","sourcesContent":["cc.Class({\n    extends:require(\"SkinNode\"),\n    _onPreDestroy(){\n        this._super();\n    },\n    ctor(){\n        this.sp = this.addComponent(cc.Sprite);\n        this.skinInfoStr = undefined;\n        this.atlas = undefined;\n    },\n    updateAtlas(atlas){\n        this.atlas = atlas;\n    },\n    setCompleteCallback(callback){\n        this.completeCallback = callback;\n    },\n    setColor(colorStr){\n        this.color = cc.utils.color(colorStr);\n    },\n    resetSkinData(){\n        this.name = \"\";\n        this.x = 0;\n        this.y = 0;\n        this.anchorX = 0.5;\n        this.anchorY = 0.5;\n        this.rotation = 0;\n        this.scale = 1;\n        this.color = cc.color(255,255,255);\n        this.autoDestroy = false;\n        this.playCount = undefined;\n        this.playTime = undefined;\n        this.interval = 0.2;\n        this.zIndex = 1;\n    },\n    resetAniData(){\n        this.curFrameIdx = 0;\n        this.goTime = 0;\n        this.playCountVar = 0;\n        this.playTimeVar = 0;\n    },\n    updateInfo(skinInfo){\n        var skinInfoStr = JSON.stringify(skinInfo);\n        if(skinInfoStr == this.skinInfoStr){\n            return;\n        }\n        this.skinInfoStr = skinInfoStr;\n\n        this.resetSkinData();\n        this.resetAniData();\n\n        this.name = skinInfo.findName || this.name;\n        this.x = skinInfo.x || this.x;\n        this.y = skinInfo.y || this.y;\n        this.anchorX = skinInfo.anchorX || this.anchorX;\n        this.anchorY = skinInfo.anchorY || this.anchorY;\n        this.rotation = skinInfo.rotation || this.rotation;\n        this.scale = skinInfo.scale || this.scale;\n        this.color = cc.utils.color(skinInfo.color) || this.color;\n        this.autoDestroy = skinInfo.autoDestroy || false;\n        this.playCount = skinInfo.playCount;\n        this.playTime = skinInfo.playTime;\n        if(skinInfo.interval!=undefined){\n            this.interval = skinInfo.interval;\n        }else{\n            this.interval = 0.2;\n        }\n        this.zIndex = skinInfo.zIndex || this.zIndex;\n        if(skinInfo.atlas!=undefined){\n            this.atlas = cc.resMgr.getRes(cc.resName[skinInfo.atlas]);\n        }\n\n        var skins = skinInfo.name;\n        var skinsArr = skins.split(\"@\");\n        if(skinsArr.length<2){\n            cc.error(\"AniFrame skinsArr length <2\");\n            return;\n        }\n        var skinsPrefix = skinsArr[0];\n        var framesLen = parseInt(skinsArr[1]);\n        this.frames = [];\n        for(var i=1;i<=framesLen;i++){\n            var spFrame = this.atlas.getSpriteFrame(skinsPrefix+\"-\"+i);\n            if(spFrame){\n                this.frames.push(spFrame);\n            }\n        }\n\n        if(this.frames.length>0){\n            this.sp.spriteFrame = this.frames[0];\n        }\n\n        if(this.frames.length <= 1 && \n           this.playCount === undefined && \n           this.playTime === undefined){\n            this.sp.update = undefined;\n        }else{\n            this.sp.update = function(dt){\n                if(this.playCount !== undefined){\n                    if(this.playCountVar>=this.playCount){\n                        if(this.autoDestroy){\n                            this.destroy();\n                            return;\n                        }\n                        this.resetAniData();\n                        this.active = false;\n                        this.completeCallback(this);\n                        return;\n                    }\n                }\n                if(this.playTime !== undefined){\n                    if(this.playTimeVar>this.playTime){\n                        if(this.autoDestroy){\n                            this.destroy();\n                            return;\n                        }\n                        this.resetAniData();\n                        this.active = false;\n                        this.completeCallback(this);\n                        return;\n                    }\n                }\n                this.goTime+=dt;\n                if(this.goTime<this.interval)return;\n                this.goTime = 0;\n                this.playTimeVar += dt;\n                this.sp.spriteFrame = this.frames[this.curFrameIdx];\n                this.curFrameIdx ++;\n                if(this.curFrameIdx>=this.frames.length){\n                    this.curFrameIdx=0;\n                    this.playCountVar ++;\n                }\n            }.bind(this);\n        }\n    },\n})"]}