{"version":3,"sources":["../../../../../assets/scripts/component/assets/scripts/component/LayerMgr.js"],"names":["cc","Class","ctor","unInitLayerMgr","initLayerMgr","node","rootNode","gameui","resMgr","getRes","resName","editorui","commonui","roadSpriteFrame","getSpriteFrame","layerArr","layerMap","i","length","Node","parent","zIndex","roadInitDir","v2","Pool","require","roadPool","setBuildFunc","road","sp","addComponent","Sprite","spriteFrame","type","Type","SLICED","setInsetLeft","setInsetRight","bind","setResetFunc","active","_updatePointDirty","_updateFloorDirty","_updateBornDirty","_updateTargetDirty","_updateRoadDirty","logicUpdate","dt","_updatePoint","curPassIdx","passData","getCurPassIdx","passRow","configData","getConfigRow","roadMap","pointArr","j","pointInfo","entityMgr","createEntity","x","y","updatePoint","clearEntityByType","_updateFloor","key","floorArr","floorInfo","updateFloor","_updateBorn","bornArr","bornInfo","updateBorn","_updateTarget","targetArr","targetInfo","updateTarget","_updateRoad","reset","drawRoad","roadNode","get","width","dis","anchorX","setContentSize","size","rotation","utils","rad2ang","angle","updateRoad","showLayer","layerName"],"mappings":"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","file":"LayerMgr.js","sourceRoot":"../../../../../assets/scripts/component","sourcesContent":["cc.Class({\n    ctor(){\n        \n    },\n    unInitLayerMgr(){\n\n    },\n    initLayerMgr(node){\n        this.rootNode = node;\n\n        this.gameui = cc.resMgr.getRes(cc.resName.gameui);\n        this.editorui = cc.resMgr.getRes(cc.resName.editorui);\n        this.commonui = cc.resMgr.getRes(cc.resName.commonui);\n        this.roadSpriteFrame = this.gameui.getSpriteFrame('ui-road');\n\n        this.layerArr = [\n           \"road\",\n           \"point\",\n           \"floor\",\n           \"monster\",\n           \"tower\",\n           \"fire\",\n           \"laser\",\n           \"born\",\n           \"target\",\n           \"effect\",\n        ];\n        this.layerMap = {};\n        for(var i=0;i<this.layerArr.length;i++){\n            var node = new cc.Node();\n            node.parent = this.rootNode;\n            node.zIndex = i;\n            this.layerMap[this.layerArr[i]] = node;\n        }\n\n        this.roadInitDir = cc.v2(1,0);\n        var Pool = require(\"Pool\");\n        this.roadPool = new Pool();\n        this.roadPool.setBuildFunc(function(){\n            var road = new cc.Node();\n            road.parent = this.layerMap.road;\n\n            var sp = road.addComponent(cc.Sprite);\n            sp.spriteFrame = this.roadSpriteFrame;\n            sp.type = cc.Sprite.Type.SLICED;\n            sp.setInsetLeft(28);\n            sp.setInsetRight(28);\n\n            return road;\n        }.bind(this));\n        this.roadPool.setResetFunc(function(road){\n            road.active = false;\n        }.bind(this));\n\n        this._updatePointDirty = true;\n        this._updateFloorDirty = true;\n        this._updateBornDirty = true;\n        this._updateTargetDirty = true;\n        this._updateRoadDirty = true;\n    },\n    logicUpdate(dt){\n        \n    },\n    _updatePoint(){\n        if(!this._updatePointDirty)return;\n        var curPassIdx = cc.passData.getCurPassIdx();\n        var passRow = cc.configData.getConfigRow(\"pass\",curPassIdx);\n        for(var i in passRow.roadMap){\n            var pointArr = passRow.roadMap[i];\n            for(var j=0;j<pointArr.length;j++){\n                var pointInfo = pointArr[j];\n                this.entityMgr.createEntity(\"EntityPoint\",pointInfo.x,\n                pointInfo.y,curPassIdx,i,j);\n            }\n        }\n        this._updatePointDirty = false;\n    },\n    updatePoint(){\n        this.entityMgr.clearEntityByType(\"EntityPoint\");\n        this._updatePointDirty = true;\n    },\n\n    _updateFloor(){\n        if(!this._updateFloorDirty)return;\n        var curPassIdx = cc.passData.getCurPassIdx();\n        var passRow = cc.configData.getConfigRow(\"pass\",curPassIdx);\n        for(var key in passRow.floorArr){\n            var floorInfo = passRow.floorArr[key];\n            this.entityMgr.createEntity(\"EntityFloor\",floorInfo.x,\n            floorInfo.y,curPassIdx,key);\n        }\n        this._updateFloorDirty = false;\n    },\n    updateFloor(){\n        this.entityMgr.clearEntityByType(\"EntityFloor\");\n        this._updateFloorDirty = true;\n    },\n\n    _updateBorn(){\n        if(!this._updateBornDirty)return;\n        var curPassIdx = cc.passData.getCurPassIdx();\n        var passRow = cc.configData.getConfigRow(\"pass\",curPassIdx);\n        for(var key in passRow.bornArr){\n            var bornInfo = passRow.bornArr[key];\n            this.entityMgr.createEntity(\"EntityBorn\",bornInfo.x,\n            bornInfo.y,curPassIdx,key);\n        }\n        this._updateBornDirty = false;\n    },\n    updateBorn(){\n        this.entityMgr.clearEntityByType(\"EntityBorn\");\n        this._updateBornDirty = true;\n    },\n\n    _updateTarget(){\n        if(!this._updateTargetDirty)return;\n        var curPassIdx = cc.passData.getCurPassIdx();\n        var passRow = cc.configData.getConfigRow(\"pass\",curPassIdx);\n        for(var key in passRow.targetArr){\n            var targetInfo = passRow.targetArr[key];\n            this.entityMgr.createEntity(\"EntityTarget\",targetInfo.x,\n            targetInfo.y,curPassIdx,key);\n        }\n        this._updateTargetDirty = false;\n    },\n    updateTarget(){\n        this.entityMgr.clearEntityByType(\"EntityTarget\");\n        this._updateTargetDirty = true;\n    },\n\n    _updateRoad(){\n        if(!this._updateRoadDirty)return;\n        this.roadPool.reset();\n        var curPassIdx = cc.passData.getCurPassIdx();\n        var passRow = cc.configData.getConfigRow(\"pass\",curPassIdx);\n        for(var i in passRow.roadMap){\n            var pointArr = passRow.roadMap[i];\n            for(var j=0;j<pointArr.length-1;j++){\n                var pointInfo = pointArr[j];\n                if(pointInfo.drawRoad){\n                    var roadNode = this.roadPool.get();\n                    roadNode.active = true;\n                    var width = pointInfo.dis+36;\n                    roadNode.anchorX = 18/width;\n                    roadNode.setContentSize(cc.size(width,45));\n                    roadNode.x = pointInfo.x;\n                    roadNode.y = pointInfo.y;\n                    roadNode.rotation = -cc.utils.rad2ang(pointInfo.angle);\n                }\n\n            }\n        }\n        this._updateRoadDirty = false;\n    },\n    updateRoad(){\n        this._updateRoadDirty = true;\n    },\n    showLayer(layerName){\n        var active = this.layerMap[layerName].active;\n        this.layerMap[layerName].active = !active;\n    }\n})"]}