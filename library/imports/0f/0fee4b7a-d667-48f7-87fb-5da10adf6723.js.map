{"version":3,"sources":["../../../../assets/scripts/assets/scripts/PoolMgr.js"],"names":["cc","Class","ctor","map_useList","map_poolList","map_useIdx","destroy","type","poolList","obj","_destroyFunc","useList","setDestroyFunc","destroyFunc","setBuildFunc","buildFunc","_buildFunc","setResetFunc","resetFunc","_resetFunc","get","pop","args","undefined","useFlag","pushNoUseFlag","push","error","reset","objKey","getUse","resetAll"],"mappings":"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","file":"PoolMgr.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n    ctor(){\n        this.map_useList = {};\n        this.map_poolList = {};//[]\n        this.map_useIdx = {};//0\n    },\n    destroy(){\n        for(var type in this.map_poolList){\n            var poolList = this.map_poolList[type];\n            if(!poolList)continue;\n            for(var type in poolList){\n                var obj = poolList[type];\n                if(obj&&this._destroyFunc){\n                    this._destroyFunc(type,obj);\n                }\n            }\n        }\n        for(var type in this.map_useList){\n            var useList = this.map_useList[type];\n            if(!useList)continue;\n            for(var type in useList){\n                var obj = useList[type];\n                if(obj&&this._destroyFunc){\n                    this._destroyFunc(type,obj);\n                }\n            }\n        }\n        this.map_useList = {};\n        this.map_poolList = {};//[]\n        this.map_useIdx = {};//0\n    },\n    setDestroyFunc(destroyFunc){\n        this._destroyFunc = destroyFunc;\n    },\n    setBuildFunc(buildFunc){\n        this._buildFunc = buildFunc;\n    },\n    setResetFunc(resetFunc){\n        this._resetFunc = resetFunc;\n    },\n    get(type,...args){\n        this.map_poolList[type] = this.map_poolList[type] || [];\n        this.map_useList[type] = this.map_useList[type] || {};\n\n        var poolList = this.map_poolList[type];\n        var useList = this.map_useList[type];\n\n        var obj = poolList.pop();\n        if(!obj&&this._buildFunc){\n            obj = this._buildFunc(type,...args);\n        }\n        if(obj){\n            if(this.map_useIdx[type] == undefined)this.map_useIdx[type]=1;\n            obj.useFlag = this.map_useIdx[type];\n            this.map_useIdx[type] = this.map_useIdx[type] + 1;\n            useList[obj.useFlag] = obj;\n        }\n        return obj;\n    },\n    pushNoUseFlag(type,obj,...args){\n        this.map_poolList[type] = this.map_poolList[type] || [];\n        var poolList = this.map_poolList[type];\n        if(this._resetFunc){\n            this._resetFunc(type,obj,...args);\n        }\n        poolList.push(obj);\n    },\n    push(type,obj,...args){\n        this.map_poolList[type] = this.map_poolList[type] || [];\n        this.map_useList[type] = this.map_useList[type] || {};\n\n        var poolList = this.map_poolList[type];\n        var useList = this.map_useList[type];\n\n        var useFlag = obj.useFlag;\n        if(!useFlag){\n            cc.error(\"PoolMgr:push same obj\");\n            return;\n        }\n        delete useList[useFlag];\n        delete obj.useFlag;\n        if(this._resetFunc){\n            this._resetFunc(type,obj,...args);\n        }\n        poolList.push(obj);\n    },\n    reset(type,...args){\n        this.map_poolList[type] = this.map_poolList[type] || [];\n        this.map_useList[type] = this.map_useList[type] || {};\n\n        var poolList = this.map_poolList[type];\n        var useList = this.map_useList[type];\n\n        for(var objKey in useList){\n            var obj = useList[objKey];\n            if(obj){\n                if(this._resetFunc){\n                    this._resetFunc(type,obj,...args);\n                }\n                poolList.push(obj);\n            }\n        }\n        this.map_useList[type] = {};\n    },\n    getUse(type){\n        var useList = this.map_useList[type];\n        return useList;\n    },\n    resetAll(...args){\n        for(var type in this.map_poolList){\n            this.reset(type,...args);\n        }\n    }\n})\n"]}