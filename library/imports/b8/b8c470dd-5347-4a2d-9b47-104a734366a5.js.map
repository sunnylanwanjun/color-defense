{"version":3,"sources":["../../../../../assets/scripts/data/assets/scripts/data/EditData.js"],"names":["cc","Class","extends","require","ctor","passAll","resMgr","getRes","resName","passTpl","towerAll","towerTpl","monsterAll","monsterTpl","curEditPassIdx","undefined","curEditInfo","idx","type","wantPlaceEntity","entityType","configIdx","saveDelay","xDir","v2","modifyPoint","roadIdx","pointIdx","rowInfo","getConfigRow","pointArr","roadMap","pointInfo","length","nextPoint","dir","x","y","angle","signAngle","toFixed","dis","Math","floor","pDistance","prePoint","saveList","emitEvent","property","deletePoint","splice","newPoint","utils","clone","perPointTpl","push","deleteBorn","bornIdx","bornArr","newBorn","bornInfo","perBornTpl","deleteTarget","targetIdx","targetArr","newTarget","targetInfo","perTargetTpl","deleteFloor","floorIdx","floorArr","newFloor","floorInfo","perFloorTpl","setWantPlaceEntity","clearWantPlaceEntity","getCurEditRow","curEditList","getConfigList","deleteAllField","log","propertyArr","split","deletePropertyFromArr","modifyAllField","value","setPropertyFromArr","clearRow","clearPassRow","clearTowerRow","clearMonsterRow","editRow","savePassList","saveTowerList","saveMonsterList","modifyField","obj","setProperty","updateRow","editFloorSize","w","h","newPass","perPassTpl","passArr","newPassRow","timer","removeByType","once","writeEditorRes","JSON","stringify","bind","newTowerRow","towerType","newTower","towerArr","oldTower","getTowerRow","oldTowerType","newMonsterRow","newMonster","monsterArr","getMonsterRow","name","details","curSceneName","globalEvent","emit"],"mappings":";;;;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAAQC,QAAQ,YAAR,CADH;AAELC,QAFK,kBAEC;AACF,aAAKC,OAAL,GAAeL,GAAGM,MAAH,CAAUC,MAAV,CAAiBP,GAAGQ,OAAH,CAAWH,OAA5B,CAAf;AACA,aAAKI,OAAL,GAAeT,GAAGM,MAAH,CAAUC,MAAV,CAAiBP,GAAGQ,OAAH,CAAWC,OAA5B,CAAf;;AAEA,aAAKC,QAAL,GAAgBV,GAAGM,MAAH,CAAUC,MAAV,CAAiBP,GAAGQ,OAAH,CAAWE,QAA5B,CAAhB;AACA,aAAKC,QAAL,GAAgBX,GAAGM,MAAH,CAAUC,MAAV,CAAiBP,GAAGQ,OAAH,CAAWG,QAA5B,CAAhB;;AAEA,aAAKC,UAAL,GAAkBZ,GAAGM,MAAH,CAAUC,MAAV,CAAiBP,GAAGQ,OAAH,CAAWI,UAA5B,CAAlB;AACA,aAAKC,UAAL,GAAkBb,GAAGM,MAAH,CAAUC,MAAV,CAAiBP,GAAGQ,OAAH,CAAWK,UAA5B,CAAlB;;AAEA,aAAKC,cAAL,GAAsBC,SAAtB;AACA,aAAKC,WAAL,GAAmB;AACfC,iBAAIF,SADW;AAEfG,kBAAKH;AAFU,SAAnB;AAIA,aAAKI,eAAL,GAAuB;AACnBC,wBAAWL,SADQ;AAEnBM,uBAAUN;AAFS,SAAvB;AAIA,aAAKO,SAAL,GAAiB,EAAjB;AACA,aAAKC,IAAL,GAAYvB,GAAGwB,EAAH,CAAM,CAAN,EAAQ,CAAR,CAAZ;AACH,KAvBI;AAwBLC,eAxBK,uBAwBOR,GAxBP,EAwBWS,OAxBX,EAwBmBC,QAxBnB,EAwB4B;AAC7B,YAAIC,UAAU,KAAKC,YAAL,CAAkB,MAAlB,EAAyBZ,GAAzB,CAAd;AACA,YAAIa,WAAWF,QAAQG,OAAR,CAAgBL,OAAhB,CAAf;AACA,YAAIM,YAAYF,SAASH,QAAT,CAAhB;;AAEA,YAAGA,WAAS,CAAT,GAAWG,SAASG,MAAvB,EAA8B;AAC1B,gBAAIC,YAAYJ,SAASH,WAAS,CAAlB,CAAhB;AACA,gBAAIQ,MAAMnC,GAAGwB,EAAH,CAAMU,UAAUE,CAAV,GAAYJ,UAAUI,CAA5B,EAA8BF,UAAUG,CAAV,GAAYL,UAAUK,CAApD,CAAV;AACA,gBAAIC,QAAQH,IAAII,SAAJ,CAAc,KAAKhB,IAAnB,CAAZ;AACAS,sBAAUM,KAAV,GAAkBA,MAAME,OAAN,CAAc,CAAd,CAAlB;AACAR,sBAAUS,GAAV,GAAgBC,KAAKC,KAAL,CAAW3C,GAAG4C,SAAH,CAAaZ,SAAb,EAAuBE,SAAvB,CAAX,CAAhB;AACH;;AAED,YAAGP,WAAS,CAAT,IAAY,CAAf,EAAiB;AACb,gBAAIkB,WAAWf,SAASH,WAAS,CAAlB,CAAf;AACA,gBAAIQ,MAAMnC,GAAGwB,EAAH,CAAMQ,UAAUI,CAAV,GAAYS,SAAST,CAA3B,EAA6BJ,UAAUK,CAAV,GAAYQ,SAASR,CAAlD,CAAV;AACA,gBAAIC,QAAQH,IAAII,SAAJ,CAAc,KAAKhB,IAAnB,CAAZ;AACAsB,qBAASP,KAAT,GAAiBA,MAAME,OAAN,CAAc,CAAd,CAAjB;AACAK,qBAASJ,GAAT,GAAeC,KAAKC,KAAL,CAAW3C,GAAG4C,SAAH,CAAaZ,SAAb,EAAuBa,QAAvB,CAAX,CAAf;AACH;;AAED,aAAKC,QAAL,CAAc,MAAd;;AAEA,aAAKC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN;AACrCD,iBAAIA,GADiC,EAC7B+B,UAAS,YADoB,EAArC;AAEH,KAjDI;AAkDLC,eAlDK,uBAkDOhC,GAlDP,EAkDWS,OAlDX,EAkDmBC,QAlDnB,EAkD4B;AAC7B,YAAIC,UAAU,KAAKC,YAAL,CAAkB,MAAlB,EAAyBZ,GAAzB,CAAd;AACA,YAAIa,WAAWF,QAAQG,OAAR,CAAgBL,OAAhB,CAAf;AACAI,iBAASoB,MAAT,CAAgBvB,QAAhB,EAAyB,CAAzB;AACA,YAAGG,SAASG,MAAT,IAAmB,CAAtB,EAAwB;AACpB,mBAAOL,QAAQG,OAAR,CAAgBL,OAAhB,CAAP;AACH;;AAED,YAAGI,SAASG,MAAT,GAAgB,CAAnB,EAAqB;AACjB,gBAAGN,YAAYG,SAASG,MAAxB,EAA+B;AAC3B,oBAAIY,WAAWf,SAASH,WAAS,CAAlB,CAAf;AACAkB,yBAASJ,GAAT,GAAe,CAAf;AACAI,yBAASP,KAAT,GAAiB,CAAjB;AACH,aAJD,MAIM,IAAGX,WAAW,CAAd,EAAgB;AAClB,oBAAIkB,WAAWf,SAASH,WAAS,CAAlB,CAAf;AACA,oBAAIO,YAAYJ,SAASH,QAAT,CAAhB;AACA,oBAAIQ,MAAMnC,GAAGwB,EAAH,CAAMU,UAAUE,CAAV,GAAYS,SAAST,CAA3B,EAA6BF,UAAUG,CAAV,GAAYQ,SAASR,CAAlD,CAAV;AACA,oBAAIC,QAAQH,IAAII,SAAJ,CAAc,KAAKhB,IAAnB,CAAZ;AACAsB,yBAASP,KAAT,GAAiBA,MAAME,OAAN,CAAc,CAAd,CAAjB;AACAK,yBAASJ,GAAT,GAAeC,KAAKC,KAAL,CAAW3C,GAAG4C,SAAH,CAAaC,QAAb,EAAsBX,SAAtB,CAAX,CAAf;AACH;AACJ;;AAED,aAAKY,QAAL,CAAc,MAAd;;AAEA,aAAKC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN;AACrCD,iBAAIA,GADiC,EAC7B+B,UAAS,SADoB,EAArC;AAEH,KA7EI;AA8ELG,YA9EK,oBA8EIlC,GA9EJ,EA8EQmB,CA9ER,EA8EUC,CA9EV,EA8EYX,OA9EZ,EA8EoB;AACrB,YAAIE,UAAU,KAAKC,YAAL,CAAkB,MAAlB,EAAyBZ,GAAzB,CAAd;;AAEAW,gBAAQG,OAAR,CAAgBL,OAAhB,IAA2BE,QAAQG,OAAR,CAAgBL,OAAhB,KAA4B,EAAvD;AACA,YAAII,WAAWF,QAAQG,OAAR,CAAgBL,OAAhB,CAAf;;AAEA,YAAIM,YAAYhC,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAK5C,OAAL,CAAa6C,WAA5B,CAAhB;AACAtB,kBAAUI,CAAV,GAAcA,CAAd;AACAJ,kBAAUK,CAAV,GAAcA,CAAd;AACAP,iBAASyB,IAAT,CAAcvB,SAAd;;AAEA,YAAGF,SAASG,MAAT,GAAgB,CAAnB,EAAqB;AACjB,gBAAIY,WAAWf,SAASA,SAASG,MAAT,GAAgB,CAAzB,CAAf;AACA,gBAAIE,MAAMnC,GAAGwB,EAAH,CAAMQ,UAAUI,CAAV,GAAYS,SAAST,CAA3B,EAA6BJ,UAAUK,CAAV,GAAYQ,SAASR,CAAlD,CAAV;AACA,gBAAIC,QAAQH,IAAII,SAAJ,CAAc,KAAKhB,IAAnB,CAAZ;AACAsB,qBAASP,KAAT,GAAiBA,MAAME,OAAN,CAAc,CAAd,CAAjB;AACAK,qBAASJ,GAAT,GAAeC,KAAKC,KAAL,CAAW3C,GAAG4C,SAAH,CAAaC,QAAb,EAAsBb,SAAtB,CAAX,CAAf;AACH;;AAED,aAAKc,QAAL,CAAc,MAAd;;AAEA,aAAKC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN;AACrCD,iBAAIA,GADiC,EAC7B+B,UAAS,SADoB,EAArC;AAEH,KArGI;AAsGLQ,cAtGK,sBAsGMvC,GAtGN,EAsGUwC,OAtGV,EAsGkB;AACnB,YAAI7B,UAAU,KAAKC,YAAL,CAAkB,MAAlB,EAAyBZ,GAAzB,CAAd;AACAW,gBAAQ8B,OAAR,CAAgBR,MAAhB,CAAuBO,OAAvB,EAA+B,CAA/B;AACA,aAAKX,QAAL,CAAc,MAAd;;AAEA,aAAKC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN;AACrCD,iBAAIA,GADiC,EAC7B+B,UAAS,SADoB,EAArC;AAEH,KA7GI;AA8GLW,WA9GK,mBA8GG1C,GA9GH,EA8GOmB,CA9GP,EA8GSC,CA9GT,EA8GW;AACZ,YAAIT,UAAU,KAAKC,YAAL,CAAkB,MAAlB,EAAyBZ,GAAzB,CAAd;AACA,YAAI2C,WAAW5D,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAK5C,OAAL,CAAaoD,UAA5B,CAAf;AACAD,iBAASxB,CAAT,GAAaA,CAAb;AACAwB,iBAASvB,CAAT,GAAaA,CAAb;AACAT,gBAAQ8B,OAAR,CAAgBH,IAAhB,CAAqBK,QAArB;AACA,aAAKd,QAAL,CAAc,MAAd;;AAEA,aAAKC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN;AACrCD,iBAAIA,GADiC,EAC7B+B,UAAS,SADoB,EAArC;AAEH,KAxHI;AAyHLc,gBAzHK,wBAyHQ7C,GAzHR,EAyHY8C,SAzHZ,EAyHsB;AACvB,YAAInC,UAAU,KAAKC,YAAL,CAAkB,MAAlB,EAAyBZ,GAAzB,CAAd;AACAW,gBAAQoC,SAAR,CAAkBd,MAAlB,CAAyBa,SAAzB,EAAmC,CAAnC;AACA,aAAKjB,QAAL,CAAc,MAAd;;AAEA,aAAKC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN;AACrCD,iBAAIA,GADiC,EAC7B+B,UAAS,WADoB,EAArC;AAEH,KAhII;AAiILiB,aAjIK,qBAiIKhD,GAjIL,EAiISmB,CAjIT,EAiIWC,CAjIX,EAiIa;AACd,YAAIT,UAAU,KAAKC,YAAL,CAAkB,MAAlB,EAAyBZ,GAAzB,CAAd;AACA,YAAIiD,aAAalE,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAK5C,OAAL,CAAa0D,YAA5B,CAAjB;AACAD,mBAAW9B,CAAX,GAAeA,CAAf;AACA8B,mBAAW7B,CAAX,GAAeA,CAAf;AACAT,gBAAQoC,SAAR,CAAkBT,IAAlB,CAAuBW,UAAvB;AACA,aAAKpB,QAAL,CAAc,MAAd;;AAEA,aAAKC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN;AACrCD,iBAAIA,GADiC,EAC7B+B,UAAS,WADoB,EAArC;AAEH,KA3II;AA4ILoB,eA5IK,uBA4IOnD,GA5IP,EA4IWoD,QA5IX,EA4IoB;AACrB,YAAIzC,UAAU,KAAKC,YAAL,CAAkB,MAAlB,EAAyBZ,GAAzB,CAAd;AACAW,gBAAQ0C,QAAR,CAAiBpB,MAAjB,CAAwBmB,QAAxB,EAAiC,CAAjC;AACA,aAAKvB,QAAL,CAAc,MAAd;;AAEA,aAAKC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN;AACrCD,iBAAIA,GADiC,EAC7B+B,UAAS,UADoB,EAArC;AAEH,KAnJI;AAoJLuB,YApJK,oBAoJItD,GApJJ,EAoJQmB,CApJR,EAoJUC,CApJV,EAoJY;AACb,YAAIT,UAAU,KAAKC,YAAL,CAAkB,MAAlB,EAAyBZ,GAAzB,CAAd;AACA,YAAIuD,YAAYxE,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAK5C,OAAL,CAAagE,WAA5B,CAAhB;AACAD,kBAAUpC,CAAV,GAAcA,CAAd;AACAoC,kBAAUnC,CAAV,GAAcA,CAAd;AACAT,gBAAQ0C,QAAR,CAAiBf,IAAjB,CAAsBiB,SAAtB;AACA,aAAK1B,QAAL,CAAc,MAAd;;AAEA,aAAKC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN;AACrCD,iBAAIA,GADiC,EAC7B+B,UAAS,UADoB,EAArC;AAEH,KA9JI;AA+JL0B,sBA/JK,8BA+JctD,UA/Jd,EA+JyBC,SA/JzB,EA+JmC;AACpC,aAAKF,eAAL,CAAqBC,UAArB,GAAkCA,UAAlC;AACA,aAAKD,eAAL,CAAqBE,SAArB,GAAiCA,SAAjC;AACH,KAlKI;AAmKLsD,wBAnKK,kCAmKiB;AAClB,aAAKxD,eAAL,GAAuB,EAAvB;AACA,aAAK4B,SAAL,CAAe,+BAAf;AACH,KAtKI;AAuKL6B,iBAvKK,2BAuKU;AACX,YAAIC,cAAc,KAAKC,aAAL,CAAmB,KAAK9D,WAAL,CAAiBE,IAApC,CAAlB;AACA,YAAG,CAAC2D,WAAJ,EAAgB;AACZ;AACH;AACD,eAAOA,YAAY,KAAK7D,WAAL,CAAiBC,GAA7B,CAAP;AACH,KA7KI;AA8KL8D,kBA9KK,0BA8KU7D,IA9KV,EA8Ke8B,QA9Kf,EA8KwB;AAAA;;AACzB,YAAI6B,cAAc,KAAKC,aAAL,CAAmB5D,IAAnB,CAAlB;AACA,YAAG,CAAC2D,WAAJ,EAAgB;AACZ7E,eAAGgF,GAAH,CAAO,0DAAP,EAAkE9D,IAAlE;AACA;AACH;AACD,YAAI+D,cAAcjC,SAASkC,KAAT,CAAe,GAAf,CAAlB;AACA,wBAAG9B,KAAH,EAAS+B,qBAAT,mBAA+BN,WAA/B,4BAA8CI,WAA9C;AACA,aAAKlC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAKA,IAAN,EAAWD,KAAIF,SAAf,EAAyBiC,UAASA,QAAlC,EAArC;AACA,aAAKF,QAAL,CAAc5B,IAAd;AACH,KAxLI;AAyLLkE,kBAzLK,0BAyLUlE,IAzLV,EAyLe8B,QAzLf,EAyLwBqC,KAzLxB,EAyL8B;AAAA;;AAC/B,YAAIR,cAAc,KAAKC,aAAL,CAAmB5D,IAAnB,CAAlB;AACA,YAAG,CAAC2D,WAAJ,EAAgB;AACZ7E,eAAGgF,GAAH,CAAO,0DAAP,EAAkE9D,IAAlE;AACA;AACH;AACD,YAAI+D,cAAcjC,SAASkC,KAAT,CAAe,GAAf,CAAlB;AACAD,oBAAY1B,IAAZ,CAAiB8B,KAAjB;AACA,yBAAGjC,KAAH,EAASkC,kBAAT,oBAA4BT,WAA5B,4BAA2CI,WAA3C;AACA,aAAKlC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAKA,IAAN,EAAWD,KAAIF,SAAf,EAAyBiC,UAASA,QAAlC,EAArC;AACA,aAAKF,QAAL,CAAc5B,IAAd;AACH,KApMI;AAqMLqE,YArMK,oBAqMIrE,IArMJ,EAqMSD,GArMT,EAqMa;AACd,gBAAOC,IAAP;AACI,iBAAK,MAAL;AACA,qBAAKsE,YAAL,CAAkBvE,GAAlB;AACA;AACA,iBAAK,OAAL;AACA,qBAAKwE,aAAL,CAAmBxE,GAAnB;AACA;AACA,iBAAK,SAAL;AACA,qBAAKyE,eAAL,CAAqBzE,GAArB;AACA;AATJ;AAWH,KAjNI;AAkNL0E,WAlNK,mBAkNGzE,IAlNH,EAkNQD,GAlNR,EAkNY;AACb,YAAGC,QAAQ,MAAX,EAAkB;AACd,iBAAKJ,cAAL,GAAsBG,GAAtB;AACH;AACD,aAAKD,WAAL,CAAiBC,GAAjB,GAAuBA,GAAvB;AACA,aAAKD,WAAL,CAAiBE,IAAjB,GAAwBA,IAAxB;AACA,aAAK6B,SAAL,CAAe,kBAAf,EAAkC,EAAC7B,MAAKA,IAAN,EAAWD,KAAIA,GAAf,EAAlC;AACH,KAzNI;AA0NL6B,YA1NK,oBA0NI5B,IA1NJ,EA0NS;AACV,gBAAOA,IAAP;AACI,iBAAK,MAAL;AACA,qBAAK0E,YAAL;AACA;AACA,iBAAK,OAAL;AACA,qBAAKC,aAAL;AACA;AACA,iBAAK,SAAL;AACA,qBAAKC,eAAL;AACA;AATJ;AAWH,KAtOI;AAuOLC,eAvOK,uBAuOO7E,IAvOP,EAuOYD,GAvOZ,EAuOgB+B,QAvOhB,EAuOyBqC,KAvOzB,EAuO+B;AAAA;;AAChC,YAAIR,cAAc,KAAKC,aAAL,CAAmB5D,IAAnB,CAAlB;AACA,YAAG,CAAC2D,WAAJ,EAAgB;AACZ7E,eAAGgF,GAAH,CAAO,0DAAP,EAAkE,KAAKhE,WAAL,CAAiBE,IAAnF;AACA;AACH;AACD,YAAI8E,MAAMnB,YAAY5D,GAAZ,CAAV;AACA,YAAIgE,cAAcjC,SAASkC,KAAT,CAAe,GAAf,CAAlB;AACAD,oBAAY1B,IAAZ,CAAiB8B,KAAjB;AACA,yBAAGjC,KAAH,EAAS6C,WAAT,oBAAqBD,GAArB,4BAA4Bf,WAA5B;AACA,aAAKlC,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAKA,IAAN,EAAWD,KAAIA,GAAf,EAAmB+B,UAASA,QAA5B,EAArC;AACA,aAAKF,QAAL,CAAc5B,IAAd;AACH,KAnPI;AAoPLgF,aApPK,qBAoPKhF,IApPL,EAoPUD,GApPV,EAoPc+E,GApPd,EAoPkB;AACnB,YAAInB,cAAc,KAAKC,aAAL,CAAmB5D,IAAnB,CAAlB;AACA,YAAG,CAAC2D,WAAJ,EAAgB;AACZ7E,eAAGgF,GAAH,CAAO,0DAAP,EAAkE,KAAKhE,WAAL,CAAiBE,IAAnF;AACA;AACH;AACD2D,oBAAY5D,GAAZ,IAAmB+E,GAAnB;AACA,aAAKjD,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAKA,IAAN,EAAWD,KAAIA,GAAf,EAArC;AACA,aAAK6B,QAAL,CAAc5B,IAAd;AACH,KA7PI;;;AA+PL;AACA;AACAiF,iBAjQK,yBAiQSC,CAjQT,EAiQW;AACZ,aAAK/F,OAAL,CAAamE,SAAb,CAAuB4B,CAAvB,GAA2BA,KAAK,KAAK/F,OAAL,CAAamE,SAAb,CAAuB4B,CAAvD;AACA,aAAK/F,OAAL,CAAamE,SAAb,CAAuB6B,CAAvB,GAA2BD,KAAK,KAAK/F,OAAL,CAAamE,SAAb,CAAuB6B,CAAvD;AACArG,WAAGgF,GAAH,CAAO,wBAAP,EAAgC,KAAK3E,OAAL,CAAamE,SAAb,CAAuB4B,CAAvD,EACA,KAAK/F,OAAL,CAAamE,SAAb,CAAuB6B,CADvB;AAEA,aAAKtD,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN,EAAaD,KAAIF,SAAjB,EAA2BiC,UAAS,WAApC,EAArC;AACA,aAAK4C,YAAL;AACH,KAxQI;AAyQLJ,gBAzQK,wBAyQQvE,GAzQR,EAyQY;AACbjB,WAAGgF,GAAH,CAAO,uBAAP,EAA+B/D,GAA/B;AACA,YAAIqF,UAAUtG,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAK5C,OAAL,CAAa8F,UAA5B,CAAd;AACAD,gBAAQrF,GAAR,GAAcA,GAAd;AACA,aAAKZ,OAAL,CAAamG,OAAb,CAAqBvF,GAArB,IAA0BqF,OAA1B;AACA,aAAKvD,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,MAAN,EAAaD,KAAIA,GAAjB,EAArC;AACA,aAAK2E,YAAL;AACH,KAhRI;AAiRLa,cAjRK,wBAiRO;AACRzG,WAAGgF,GAAH,CAAO,kBAAP;AACA,YAAIsB,UAAUtG,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAK5C,OAAL,CAAa8F,UAA5B,CAAd;AACAD,gBAAQrF,GAAR,GAAc,KAAKZ,OAAL,CAAamG,OAAb,CAAqBvE,MAAnC;AACA,aAAK5B,OAAL,CAAamG,OAAb,CAAqBF,QAAQrF,GAA7B,IAAkCqF,OAAlC;AACA,aAAKV,YAAL;AACH,KAvRI;AAwRLA,gBAxRK,0BAwRS;AACV5F,WAAG0G,KAAH,CAASC,YAAT,CAAsB,eAAtB;AACA3G,WAAG0G,KAAH,CAASE,IAAT,CAAc,YAAU;AACpB5G,eAAGM,MAAH,CAAUuG,cAAV,CAAyB,sBAAzB,EAAgDC,KAAKC,SAAL,CAAe,KAAK1G,OAApB,CAAhD;AACH,SAFa,CAEZ2G,IAFY,CAEP,IAFO,CAAd,EAEa,KAAK1F,SAFlB,EAE4B,eAF5B;AAGH,KA7RI;;;AA+RL;AACA;AACA2F,eAjSK,uBAiSOC,SAjSP,EAiSiB;AAClBlH,WAAGgF,GAAH,CAAO,mBAAP,EAA2BkC,SAA3B;AACA,YAAIC,WAAWnH,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAK1C,QAAL,CAAcuG,SAAd,CAAf,CAAf;AACAC,iBAASlG,GAAT,GAAe,KAAKP,QAAL,CAAc0G,QAAd,CAAuBnF,MAAtC;AACA,aAAKvB,QAAL,CAAc0G,QAAd,CAAuBD,SAASlG,GAAhC,IAAqCkG,QAArC;AACA,aAAKpE,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,OAAN,EAArC;AACA,aAAK2E,aAAL;AACH,KAxSI;AAySLJ,iBAzSK,yBAySSxE,GAzST,EAySa;AACdjB,WAAGgF,GAAH,CAAO,wBAAP,EAAgC/D,GAAhC;AACA,YAAIoG,WAAW,KAAKC,WAAL,CAAiBrG,GAAjB,CAAf;AACA,YAAIsG,eAAeF,SAASnG,IAA5B;AACA,YAAIiG,WAAWnH,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAK1C,QAAL,CAAc4G,YAAd,CAAf,CAAf;AACAJ,iBAASlG,GAAT,GAAeA,GAAf;AACA,aAAKP,QAAL,CAAc0G,QAAd,CAAuBnG,GAAvB,IAA4BkG,QAA5B;AACA,aAAKpE,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,OAAN,EAAcD,KAAIA,GAAlB,EAArC;AACA,aAAK4E,aAAL;AACH,KAlTI;AAmTLyB,eAnTK,uBAmTOrG,GAnTP,EAmTW;AACZ,eAAO,KAAKP,QAAL,CAAc0G,QAAd,CAAuBnG,GAAvB,CAAP;AACH,KArTI;AAsTL4E,iBAtTK,2BAsTU;AACX7F,WAAG0G,KAAH,CAASC,YAAT,CAAsB,gBAAtB;AACA3G,WAAG0G,KAAH,CAASE,IAAT,CAAc,YAAU;AACpB5G,eAAGM,MAAH,CAAUuG,cAAV,CAAyB,uBAAzB,EAAiDC,KAAKC,SAAL,CAAe,KAAKrG,QAApB,CAAjD;AACH,SAFa,CAEZsG,IAFY,CAEP,IAFO,CAAd,EAEa,KAAK1F,SAFlB,EAE4B,gBAF5B;AAGH,KA3TI;;;AA6TL;AACA;AACAkG,iBA/TK,2BA+TU;AACXxH,WAAGgF,GAAH,CAAO,qBAAP;AACA,YAAIyC,aAAazH,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAKxC,UAAL,CAAgBA,UAA/B,CAAjB;AACA4G,mBAAWxG,GAAX,GAAiB,KAAKL,UAAL,CAAgB8G,UAAhB,CAA2BzF,MAA5C;AACA,aAAKrB,UAAL,CAAgB8G,UAAhB,CAA2BD,WAAWxG,GAAtC,IAA2CwG,UAA3C;AACA,aAAK1E,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,SAAN,EAArC;AACA,aAAK4E,eAAL;AACH,KAtUI;AAuULJ,mBAvUK,2BAuUWzE,GAvUX,EAuUe;AAChBjB,WAAGgF,GAAH,CAAO,0BAAP,EAAkC/D,GAAlC;AACA,YAAIwG,aAAazH,GAAGoD,KAAH,CAASC,KAAT,CAAe,KAAKxC,UAAL,CAAgBA,UAA/B,CAAjB;AACA4G,mBAAWxG,GAAX,GAAiBA,GAAjB;AACA,aAAKL,UAAL,CAAgB8G,UAAhB,CAA2BzG,GAA3B,IAAgCwG,UAAhC;AACA,aAAK1E,SAAL,CAAe,qBAAf,EAAqC,EAAC7B,MAAK,SAAN,EAAgBD,KAAIA,GAApB,EAArC;AACA,aAAK6E,eAAL;AACH,KA9UI;AA+UL6B,iBA/UK,yBA+US1G,GA/UT,EA+Ua;AACd,eAAO,KAAKL,UAAL,CAAgB8G,UAAhB,CAA2BzG,GAA3B,CAAP;AACH,KAjVI;AAkVL6E,mBAlVK,6BAkVY;AACb9F,WAAG0G,KAAH,CAASC,YAAT,CAAsB,kBAAtB;AACA3G,WAAG0G,KAAH,CAASE,IAAT,CAAc,YAAU;AACpB5G,eAAGM,MAAH,CAAUuG,cAAV,CAAyB,yBAAzB,EAAmDC,KAAKC,SAAL,CAAe,KAAKnG,UAApB,CAAnD;AACH,SAFa,CAEZoG,IAFY,CAEP,IAFO,CAAd,EAEa,KAAK1F,SAFlB,EAE4B,kBAF5B;AAGH,KAvVI;AAyVLyB,aAzVK,qBAyVK6E,IAzVL,EAyVUC,OAzVV,EAyVkB;AACnB,YAAG7H,GAAGM,MAAH,CAAUwH,YAAV,IAA0B,QAA7B,EAAsC;AAClC9H,eAAG+H,WAAH,CAAeC,IAAf,CAAoBJ,IAApB,EAAyBC,OAAzB;AACH;AACJ;AA7VI,CAAT","file":"EditData.js","sourceRoot":"../../../../../assets/scripts/data","sourcesContent":["cc.Class({\n    extends:require(\"ConfigData\"),\n    ctor(){\n        this.passAll = cc.resMgr.getRes(cc.resName.passAll);\n        this.passTpl = cc.resMgr.getRes(cc.resName.passTpl);\n\n        this.towerAll = cc.resMgr.getRes(cc.resName.towerAll);\n        this.towerTpl = cc.resMgr.getRes(cc.resName.towerTpl);\n\n        this.monsterAll = cc.resMgr.getRes(cc.resName.monsterAll);\n        this.monsterTpl = cc.resMgr.getRes(cc.resName.monsterTpl);\n\n        this.curEditPassIdx = undefined;\n        this.curEditInfo = {\n            idx:undefined,\n            type:undefined,\n        }\n        this.wantPlaceEntity = {\n            entityType:undefined,\n            configIdx:undefined,\n        };\n        this.saveDelay = 10;\n        this.xDir = cc.v2(1,0);\n    },\n    modifyPoint(idx,roadIdx,pointIdx){\n        var rowInfo = this.getConfigRow(\"pass\",idx);\n        var pointArr = rowInfo.roadMap[roadIdx];\n        var pointInfo = pointArr[pointIdx];\n\n        if(pointIdx+1<pointArr.length){\n            var nextPoint = pointArr[pointIdx+1];\n            var dir = cc.v2(nextPoint.x-pointInfo.x,nextPoint.y-pointInfo.y);\n            var angle = dir.signAngle(this.xDir);\n            pointInfo.angle = angle.toFixed(3);\n            pointInfo.dis = Math.floor(cc.pDistance(pointInfo,nextPoint));\n        }\n\n        if(pointIdx-1>=0){\n            var prePoint = pointArr[pointIdx-1];\n            var dir = cc.v2(pointInfo.x-prePoint.x,pointInfo.y-prePoint.y);\n            var angle = dir.signAngle(this.xDir);\n            prePoint.angle = angle.toFixed(3);\n            prePoint.dis = Math.floor(cc.pDistance(pointInfo,prePoint));\n        }\n\n        this.saveList(\"pass\");\n\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",\n        idx:idx,property:\"updateRoad\"});\n    },\n    deletePoint(idx,roadIdx,pointIdx){\n        var rowInfo = this.getConfigRow(\"pass\",idx);\n        var pointArr = rowInfo.roadMap[roadIdx];\n        pointArr.splice(pointIdx,1);\n        if(pointArr.length == 0){\n            delete rowInfo.roadMap[roadIdx];\n        }\n\n        if(pointArr.length>1){\n            if(pointIdx == pointArr.length){\n                var prePoint = pointArr[pointIdx-1];\n                prePoint.dis = 0;\n                prePoint.angle = 0;\n            }else if(pointIdx > 0){\n                var prePoint = pointArr[pointIdx-1];\n                var nextPoint = pointArr[pointIdx];\n                var dir = cc.v2(nextPoint.x-prePoint.x,nextPoint.y-prePoint.y);\n                var angle = dir.signAngle(this.xDir);\n                prePoint.angle = angle.toFixed(3);\n                prePoint.dis = Math.floor(cc.pDistance(prePoint,nextPoint));\n            }\n        }\n\n        this.saveList(\"pass\");\n\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",\n        idx:idx,property:\"roadMap\"});\n    },\n    newPoint(idx,x,y,roadIdx){\n        var rowInfo = this.getConfigRow(\"pass\",idx);\n\n        rowInfo.roadMap[roadIdx] = rowInfo.roadMap[roadIdx] || [];\n        var pointArr = rowInfo.roadMap[roadIdx];\n\n        var pointInfo = cc.utils.clone(this.passTpl.perPointTpl);\n        pointInfo.x = x;\n        pointInfo.y = y;\n        pointArr.push(pointInfo);\n\n        if(pointArr.length>1){\n            var prePoint = pointArr[pointArr.length-2];\n            var dir = cc.v2(pointInfo.x-prePoint.x,pointInfo.y-prePoint.y);\n            var angle = dir.signAngle(this.xDir);\n            prePoint.angle = angle.toFixed(3);\n            prePoint.dis = Math.floor(cc.pDistance(prePoint,pointInfo));\n        }\n\n        this.saveList(\"pass\");\n\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",\n        idx:idx,property:\"roadMap\"});\n    },\n    deleteBorn(idx,bornIdx){\n        var rowInfo = this.getConfigRow(\"pass\",idx);\n        rowInfo.bornArr.splice(bornIdx,1);\n        this.saveList(\"pass\");\n\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",\n        idx:idx,property:\"bornArr\"});\n    },\n    newBorn(idx,x,y){\n        var rowInfo = this.getConfigRow(\"pass\",idx);\n        var bornInfo = cc.utils.clone(this.passTpl.perBornTpl);\n        bornInfo.x = x;\n        bornInfo.y = y;\n        rowInfo.bornArr.push(bornInfo);\n        this.saveList(\"pass\");\n\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",\n        idx:idx,property:\"bornArr\"});\n    },\n    deleteTarget(idx,targetIdx){\n        var rowInfo = this.getConfigRow(\"pass\",idx);\n        rowInfo.targetArr.splice(targetIdx,1);\n        this.saveList(\"pass\");\n\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",\n        idx:idx,property:\"targetArr\"});\n    },\n    newTarget(idx,x,y){\n        var rowInfo = this.getConfigRow(\"pass\",idx);\n        var targetInfo = cc.utils.clone(this.passTpl.perTargetTpl);\n        targetInfo.x = x;\n        targetInfo.y = y;\n        rowInfo.targetArr.push(targetInfo);\n        this.saveList(\"pass\");\n\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",\n        idx:idx,property:\"targetArr\"});\n    },\n    deleteFloor(idx,floorIdx){\n        var rowInfo = this.getConfigRow(\"pass\",idx);\n        rowInfo.floorArr.splice(floorIdx,1);\n        this.saveList(\"pass\");\n\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",\n        idx:idx,property:\"floorArr\"});\n    },\n    newFloor(idx,x,y){\n        var rowInfo = this.getConfigRow(\"pass\",idx);\n        var floorInfo = cc.utils.clone(this.passTpl.perFloorTpl);\n        floorInfo.x = x;\n        floorInfo.y = y;\n        rowInfo.floorArr.push(floorInfo);\n        this.saveList(\"pass\");\n\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",\n        idx:idx,property:\"floorArr\"});\n    },\n    setWantPlaceEntity(entityType,configIdx){\n        this.wantPlaceEntity.entityType = entityType;\n        this.wantPlaceEntity.configIdx = configIdx;\n    },\n    clearWantPlaceEntity(){\n        this.wantPlaceEntity = {}\n        this.emitEvent(\"EditData:clearWantPlaceEntity\");\n    },\n    getCurEditRow(){\n        var curEditList = this.getConfigList(this.curEditInfo.type);\n        if(!curEditList){\n            return;\n        }\n        return curEditList[this.curEditInfo.idx];\n    },\n    deleteAllField(type,property){\n        var curEditList = this.getConfigList(type);\n        if(!curEditList){\n            cc.log(\"EditData:delete failure curEditList is undefined,type is\",type);\n            return;\n        }\n        var propertyArr = property.split(\"@\");\n        cc.utils.deletePropertyFromArr(curEditList,...propertyArr);\n        this.emitEvent(\"EditData:updateList\",{type:type,idx:undefined,property:property});\n        this.saveList(type);\n    },\n    modifyAllField(type,property,value){\n        var curEditList = this.getConfigList(type);\n        if(!curEditList){\n            cc.log(\"EditData:delete failure curEditList is undefined,type is\",type);\n            return;\n        }\n        var propertyArr = property.split(\"@\");\n        propertyArr.push(value);\n        cc.utils.setPropertyFromArr(curEditList,...propertyArr);\n        this.emitEvent(\"EditData:updateList\",{type:type,idx:undefined,property:property});\n        this.saveList(type);\n    },\n    clearRow(type,idx){\n        switch(type){\n            case \"pass\":\n            this.clearPassRow(idx);\n            break;\n            case \"tower\":\n            this.clearTowerRow(idx);\n            break;\n            case \"monster\":\n            this.clearMonsterRow(idx);\n            break;\n        }\n    },\n    editRow(type,idx){\n        if(type == \"pass\"){\n            this.curEditPassIdx = idx;\n        }\n        this.curEditInfo.idx = idx;\n        this.curEditInfo.type = type;\n        this.emitEvent(\"EditData:editRow\",{type:type,idx:idx});\n    },\n    saveList(type){\n        switch(type){\n            case \"pass\":\n            this.savePassList();\n            break;\n            case \"tower\":\n            this.saveTowerList();\n            break;\n            case \"monster\":\n            this.saveMonsterList();\n            break;\n        }\n    },\n    modifyField(type,idx,property,value){\n        var curEditList = this.getConfigList(type);\n        if(!curEditList){\n            cc.log(\"EditData:update failure curEditList is undefined,type is\",this.curEditInfo.type);\n            return;\n        }\n        var obj = curEditList[idx];\n        var propertyArr = property.split(\"@\");\n        propertyArr.push(value);\n        cc.utils.setProperty(obj,...propertyArr);\n        this.emitEvent(\"EditData:updateList\",{type:type,idx:idx,property:property});\n        this.saveList(type);\n    },\n    updateRow(type,idx,obj){\n        var curEditList = this.getConfigList(type);\n        if(!curEditList){\n            cc.log(\"EditData:update failure curEditList is undefined,type is\",this.curEditInfo.type);\n            return;\n        }\n        curEditList[idx] = obj;\n        this.emitEvent(\"EditData:updateList\",{type:type,idx:idx});\n        this.saveList(type);\n    },\n\n    /////////////////////////////////////////////////////////////\n    //pass 相关\n    editFloorSize(w){\n        this.passAll.floorInfo.w = w || this.passAll.floorInfo.w;\n        this.passAll.floorInfo.h = w || this.passAll.floorInfo.h;\n        cc.log(\"EditData:editFloorSize\",this.passAll.floorInfo.w,\n        this.passAll.floorInfo.h);\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",idx:undefined,property:\"floorInfo\"});\n        this.savePassList();\n    },\n    clearPassRow(idx){\n        cc.log(\"EditData:clearPassRow\",idx);\n        var newPass = cc.utils.clone(this.passTpl.perPassTpl);\n        newPass.idx = idx;\n        this.passAll.passArr[idx]=newPass;\n        this.emitEvent(\"EditData:updateList\",{type:\"pass\",idx:idx});\n        this.savePassList();\n    },\n    newPassRow(){\n        cc.log(\"EditData:newPass\");\n        var newPass = cc.utils.clone(this.passTpl.perPassTpl);\n        newPass.idx = this.passAll.passArr.length;\n        this.passAll.passArr[newPass.idx]=newPass;\n        this.savePassList();\n    },\n    savePassList(){\n        cc.timer.removeByType(\"EditData:Pass\");\n        cc.timer.once(function(){\n            cc.resMgr.writeEditorRes(\"/config/passAll.json\",JSON.stringify(this.passAll));\n        }.bind(this),this.saveDelay,\"EditData:Pass\");\n    },\n\n    /////////////////////////////////////////////////////////////\n    //tower 相关\n    newTowerRow(towerType){\n        cc.log(\"EditData:newTower\",towerType);\n        var newTower = cc.utils.clone(this.towerTpl[towerType]);\n        newTower.idx = this.towerAll.towerArr.length;\n        this.towerAll.towerArr[newTower.idx]=newTower;\n        this.emitEvent(\"EditData:updateList\",{type:\"tower\"});\n        this.saveTowerList();\n    },\n    clearTowerRow(idx){\n        cc.log(\"EditData:clearTowerRow\",idx);\n        var oldTower = this.getTowerRow(idx);\n        var oldTowerType = oldTower.type;\n        var newTower = cc.utils.clone(this.towerTpl[oldTowerType]);\n        newTower.idx = idx;\n        this.towerAll.towerArr[idx]=newTower;\n        this.emitEvent(\"EditData:updateList\",{type:\"tower\",idx:idx});\n        this.saveTowerList();\n    },\n    getTowerRow(idx){\n        return this.towerAll.towerArr[idx];\n    },\n    saveTowerList(){\n        cc.timer.removeByType(\"EditData:Tower\");\n        cc.timer.once(function(){\n            cc.resMgr.writeEditorRes(\"/config/towerAll.json\",JSON.stringify(this.towerAll));\n        }.bind(this),this.saveDelay,\"EditData:Tower\");\n    },\n\n    /////////////////////////////////////////////////////////////\n    //monster 相关\n    newMonsterRow(){\n        cc.log(\"EditData:newMonster\");\n        var newMonster = cc.utils.clone(this.monsterTpl.monsterTpl);\n        newMonster.idx = this.monsterAll.monsterArr.length;\n        this.monsterAll.monsterArr[newMonster.idx]=newMonster;\n        this.emitEvent(\"EditData:updateList\",{type:\"monster\"});\n        this.saveMonsterList();\n    },\n    clearMonsterRow(idx){\n        cc.log(\"EditData:clearMonsterRow\",idx);\n        var newMonster = cc.utils.clone(this.monsterTpl.monsterTpl);\n        newMonster.idx = idx;\n        this.monsterAll.monsterArr[idx]=newMonster;\n        this.emitEvent(\"EditData:updateList\",{type:\"monster\",idx:idx});\n        this.saveMonsterList();\n    },\n    getMonsterRow(idx){\n        return this.monsterAll.monsterArr[idx];\n    },\n    saveMonsterList(){\n        cc.timer.removeByType(\"EditData:Monster\");\n        cc.timer.once(function(){\n            cc.resMgr.writeEditorRes(\"/config/monsterAll.json\",JSON.stringify(this.monsterAll));\n        }.bind(this),this.saveDelay,\"EditData:Monster\");\n    },\n\n    emitEvent(name,details){\n        if(cc.resMgr.curSceneName == 'editor'){\n            cc.globalEvent.emit(name,details);\n        }\n    }\n});"]}