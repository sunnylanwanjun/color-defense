{"version":3,"sources":["../../../../../../assets/scripts/node/entity/assets/scripts/node/entity/EntityMonster.js"],"names":["cc","Class","extends","require","ctor","group","curPassData","passData","getCurPassData","baseNode","Node","parent","labelNode","color","y","addChild","hpLabel","addComponent","Label","string","active","resMgr","curSceneName","Unique","unique","setBuildFunc","skinName","skinInfo","skinNode","skinMgr","getSkin","bind","setResetFunc","destroy","PoolMgr","poolMgr","skinType","setCompleteCallback","push","_onPreDestroy","_super","initGameData","gameData","hp","speed","state","entityState","alive","pointArr","undefined","pointIdx","camp","initEntity","idx","myType","myIdx","updateProperty","unInitEntity","property","propValue","reset","resetAll","key","skinArr","skinColorStr","skinColor","utils","get","name","updateInfo","recoverSpeed","slowDown","slowSpeed","harm","harmHp","death","setState","showSkin","resName","deathEff","type","autoDestroy","scale","playTime","atlas","changeGold","dropGold","entityMgr","clearEntity","onUnHitBullet","bulletNode","hitSkinArr","sub","onHitBullet","add","setCamp","setRoad","logicUpdate","dt","length","pointData","nextData","deltaDis","dis2","x","deltaX","Math","cos","angle","deltaY","sin","rotation","rad2ang"],"mappings":"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","file":"EntityMonster.js","sourceRoot":"../../../../../../assets/scripts/node/entity","sourcesContent":["cc.Class({\n    extends:require(\"EntityBase\"),\n    ctor(){\n        this.group = \"monster\";\n\n        this.curPassData = cc.passData.getCurPassData();\n\n        this.baseNode = new cc.Node();\n        this.baseNode.parent = this;\n\n        var labelNode = new cc.Node();\n        labelNode.color = cc.color(255,0,0);\n        labelNode.y = 35;\n        this.addChild(labelNode);\n        this.hpLabel = labelNode.addComponent(cc.Label);\n        this.hpLabel.string = \"\";\n        labelNode.active = (cc.resMgr.curSceneName == 'editor');\n\n        var Unique = require(\"Unique\");\n        this.unique = new Unique();\n        this.unique.setBuildFunc(function(skinName,skinInfo){\n            var skinNode = cc.skinMgr.getSkin(skinInfo);\n            skinNode.parent = this.baseNode;\n            return skinNode;\n        }.bind(this));\n        this.unique.setResetFunc(function(skinNode){\n            skinNode.destroy();\n        }.bind(this));\n\n        var PoolMgr = require(\"PoolMgr\");\n        this.poolMgr = new PoolMgr;\n        this.poolMgr.setBuildFunc(function(skinType,skinInfo){\n            var skinNode = cc.skinMgr.getSkin(skinInfo);\n            skinNode.setCompleteCallback(function(){\n                this.poolMgr.push(skinType,skinNode);\n            }.bind(this));\n            skinNode.parent = this.baseNode;\n            return skinNode;\n        }.bind(this));\n        this.poolMgr.setResetFunc(function(skinType,skinNode){\n            skinNode.active = false;\n        }.bind(this));\n    },\n    _onPreDestroy(){\n        this._super();\n    },\n    initGameData(){\n        this._super();\n        this.gameData.hp = 0;\n        this.gameData.speed = 0;\n        this.gameData.state = cc.entityState.alive;\n        this.gameData.pointArr = undefined;\n        this.gameData.pointIdx = undefined;\n        this.gameData.camp = undefined;\n    },\n    initEntity(idx){\n        this._super();\n        this.myType = \"monster\";\n        this.myIdx = idx;\n        this.updateProperty();\n    },\n    unInitEntity(){\n        this._super();\n    },\n    updateProperty(property){\n        if(!this._super(property)){\n            return false;\n        }\n\n        //-----------------update gameData----------------\n        this.gameData.hp = this.propValue.hp;\n        this.gameData.speed = this.propValue.speed;\n        this.hpLabel.string = this.gameData.hp;\n        //------------------------------------------------\n\n        this.unique.reset();\n        this.poolMgr.resetAll();\n        for(var key in this.propValue.skinArr){\n            var skinInfo = this.propValue.skinArr[key];\n            this.skinColorStr = skinInfo.color;\n            this.skinColor = cc.utils.color(this.skinColorStr);\n            var skinNode = this.poolMgr.get(skinInfo.name,skinInfo);\n            skinNode.active = true;\n            skinNode.updateInfo(skinInfo);\n        }\n        return true;\n    },\n    recoverSpeed(){\n        this.gameData.speed = this.propValue.speed;\n    },\n    slowDown(slowSpeed){\n        this.gameData.speed = this.propValue.speed+slowSpeed;\n        if(this.gameData.speed<0)this.gameData.speed=0;\n    },\n    harm(harmHp){\n        if(!harmHp)return;\n        if(this.state === cc.entityState.death){\n            return;\n        }\n        this.gameData.hp+=harmHp;\n        this.hpLabel.string = this.gameData.hp;\n        if(this.gameData.hp<=0){\n            this.setState(cc.entityState.death);\n            cc.skinMgr.showSkin(this,{\n                name:cc.resName.deathEff,\n                type:\"partical\",\n                autoDestroy:true,\n                color:this.skinColorStr,\n                scale:5,\n                playTime:3,\n                atlas:\"bulletui\",\n            });\n            this.curPassData.changeGold(this.propValue.dropGold);\n            cc.entityMgr.clearEntity(this);\n        }\n    },\n    onUnHitBullet(bulletNode){\n        if(!bulletNode.propValue.hitSkinArr){\n            return;\n        }\n        for(var key in bulletNode.propValue.hitSkinArr){\n            var skinInfo = bulletNode.propValue.hitSkinArr[key];\n            if(!skinInfo.unique){\n                continue;\n            }\n            this.unique.sub(skinInfo.name);\n        }\n    },\n    onHitBullet(bulletNode){\n        if(!bulletNode.propValue.hitSkinArr){\n            return;\n        }\n        for(var key in bulletNode.propValue.hitSkinArr){\n            var skinInfo = bulletNode.propValue.hitSkinArr[key];\n            var skinNode = undefined;\n            //针对循环播放的特效，在离开的时候，需要去停止,这里用特效的名字作为唯一索引\n            if(skinInfo.unique){\n                skinNode = this.unique.add(skinInfo.name,skinInfo);\n            }else{\n                skinNode = this.poolMgr.get(skinInfo.name,skinInfo);\n            }\n            skinNode.active = true;\n            skinNode.updateInfo(skinInfo);\n        }\n    },\n    setCamp(camp){\n        this.gameData.camp = camp;\n    },\n    setRoad(pointArr){\n        this.gameData.pointArr = pointArr;\n        this.gameData.pointIdx = 0;\n    },\n    logicUpdate(dt){\n        if(this.gameData.pointArr == undefined){\n            return;\n        }\n        var pointArr = this.gameData.pointArr;\n        var pointIdx = this.gameData.pointIdx;\n        if(pointIdx>=pointArr.length-1)return;\n        var pointData = pointArr[pointIdx];\n        var nextData = pointArr[pointIdx+1];\n\n        var deltaDis = this.gameData.speed*dt;\n        if(cc.utils.dis2(this,nextData)<=deltaDis*deltaDis){\n            this.x = nextData.x;\n            this.y = nextData.y;\n            this.gameData.pointIdx++;\n            return;\n        }\n        var deltaX = deltaDis*Math.cos(pointData.angle);\n        var deltaY = deltaDis*Math.sin(pointData.angle);\n        this.x+=deltaX;\n        this.y+=deltaY;\n        this.baseNode.rotation = -90-cc.utils.rad2ang(pointData.angle);\n    }\n})"]}