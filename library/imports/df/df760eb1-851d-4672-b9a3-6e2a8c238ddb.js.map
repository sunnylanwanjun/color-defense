{"version":3,"sources":["../../../../../assets/scripts/component/assets/scripts/component/Grid.js"],"names":["cc","Class","extends","require","properties","rowCol","default","undefined","type","Label","onLoad","_super","editorui","resMgr","getRes","resName","onDestroy","showGrid","gridNode","active","start","gridSpriteFrame","getSpriteFrame","gridSize","getOriginalSize","Node","sp","addComponent","Sprite","spriteFrame","Type","TILED","parent","node","scale","anchorX","anchorY","gridHelp","color","updateGridSize","mouseMoveHandle","string","mouseHoverHandle","mousePos","halfNodeW","width","halfNodeH","height","x","y","gridInfo","getGridPos","row","col","changeGridScale","slider","progress","begPos","convertToNodeSpaceAR","v2","endPos","winSize","w","h","setContentSize","isAnchorBL","gridW","gridH","parseInt"],"mappings":"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","file":"Grid.js","sourceRoot":"../../../../../assets/scripts/component","sourcesContent":["cc.Class({\n    extends:require(\"Touch\"),\n    properties:{\n        rowCol:{\n            default:undefined,\n            type:cc.Label,\n        },\n    },\n    onLoad(){\n        this._super();\n        this.editorui = cc.resMgr.getRes(cc.resName.editorui);\n    },\n    onDestroy(){\n        this._super();\n    },\n    showGrid(){\n        this.gridNode.active = !this.gridNode.active;\n    },\n    start(){\n        this._super();\n        var gridSpriteFrame = this.editorui.getSpriteFrame(\"editor-grid\");\n        this.gridSize = gridSpriteFrame.getOriginalSize();\n\n        this.gridNode = new cc.Node();\n        var sp = this.gridNode.addComponent(cc.Sprite);\n        sp.spriteFrame = gridSpriteFrame;\n        sp.type = cc.Sprite.Type.TILED;\n        this.gridNode.parent = this.node;\n        this.gridNode.scale = 1;\n        this.gridNode.anchorX = 0;\n        this.gridNode.anchorY = 0;\n\n        this.gridHelp = new cc.Node();\n        this.gridHelp.color = cc.color(255,0,0);\n        var sp = this.gridHelp.addComponent(cc.Sprite);\n        sp.spriteFrame = gridSpriteFrame;\n        this.gridHelp.parent = this.node;\n\n        this.updateGridSize();\n    },\n    mouseMoveHandle(){\n        if(this.gridHelp){\n            this.gridHelp.active = false;\n        }\n        if(this.rowCol){\n            this.rowCol.string = \"\";\n        }\n        this.updateGridSize();\n    },\n    mouseHoverHandle(mousePos){\n        var halfNodeW = this.node.width*0.5;\n        var halfNodeH = this.node.height*0.5;\n\n        if( mousePos.x<-halfNodeW||\n            mousePos.y<-halfNodeH||\n            mousePos.x>halfNodeW||\n            mousePos.y>halfNodeH){\n            if(this.gridHelp){\n                this.gridHelp.active = false;\n            }\n            return false;\n        }\n\n        var gridInfo = this.getGridPos(mousePos.x,mousePos.y);\n        if(this.gridHelp){\n            this.gridHelp.x = gridInfo.x;\n            this.gridHelp.y = gridInfo.y;\n            this.gridHelp.active = true;\n        }\n\n        if(this.rowCol){\n            this.rowCol.string = \"r:\"+gridInfo.row+\" c:\"+gridInfo.col;\n        }\n        return true;\n    },\n    changeGridScale(slider){\n        this.gridNode.scale = slider.progress;\n        if(this.gridHelp){\n            this.gridHelp.scale = slider.progress;\n            this.gridHelp.active = false;\n        }\n        if(this.rowCol){\n            this.rowCol.string = \"\";\n        }\n        this.updateGridSize();\n    },\n    updateGridSize(){\n        var halfNodeW = this.node.width*0.5;\n        var halfNodeH = this.node.height*0.5;\n\n        var begPos = this.node.convertToNodeSpaceAR(cc.v2(0, 0));\n        if(begPos.x<-halfNodeW)begPos.x=-halfNodeW;\n        if(begPos.y<-halfNodeH)begPos.y=-halfNodeH;\n\n        var endPos = this.node.convertToNodeSpaceAR(cc.v2(cc.winSize.width, cc.winSize.height));\n\n        if(endPos.x>halfNodeW)endPos.x=halfNodeW;\n        if(endPos.y>halfNodeH)endPos.y=halfNodeH;\n\n        begPos = this.getGridPos(begPos.x,begPos.y,true);\n        endPos = this.getGridPos(endPos.x,endPos.y,true);\n\n        if(endPos.x+this.gridSize.width<halfNodeW){\n            endPos.x+=this.gridSize.width;\n            endPos.y+=this.gridSize.height;\n        }else{\n            endPos.x=halfNodeW;\n            endPos.y=halfNodeH;\n        }\n\n        var w = (endPos.x-begPos.x)/this.gridNode.scale;\n        var h = (endPos.y-begPos.y)/this.gridNode.scale;\n\n        this.gridNode.setContentSize(w,h);\n        this.gridNode.x = begPos.x;\n        this.gridNode.y = begPos.y;\n    },\n    getGridPos(x,y,isAnchorBL){\n        var halfNodeW = this.node.width*0.5;\n        var halfNodeH = this.node.height*0.5;\n        x+=halfNodeW;\n        y+=halfNodeH;\n\n        var gridW = this.gridSize.width*this.gridNode.scale;\n        var gridH = this.gridSize.height*this.gridNode.scale;\n        var col = parseInt(x/gridW);\n        var row = parseInt(y/gridH);\n\n        x = col*gridW-halfNodeW;\n        y = row*gridH-halfNodeH;\n        if(!isAnchorBL){\n            x+=gridW*0.5;\n            y+=gridH*0.5;\n        }\n        \n        return {x:x,y:y,col:col,row:row};\n    },\n})"]}