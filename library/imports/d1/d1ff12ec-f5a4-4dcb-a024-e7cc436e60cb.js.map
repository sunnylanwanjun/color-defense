{"version":3,"sources":["../../../../../../../assets/scripts/node/entity/bullet/assets/scripts/node/entity/bullet/BulletGuidemissile.js"],"names":["cc","Class","extends","require","ctor","initDir","v2","curPassIdx","passData","getCurPassIdx","initGameData","_super","gameData","curTarget","undefined","launchAng","nextDir","nextAng","goAdjustInterval","initEntity","idx","target","updateProperty","unInitEntity","property","adjustNextDir","dt","propValue","adjustInterval","x","y","normalizeSelf","signAngle","adjustDir","utils","wrapRad_0_2pi","changeDir","ang","pi","pi2","endAng","adjustAng","wrapRad_fpi_zpi","logicUpdate","isAlive","entityMgr","getNearEntity","moveHelp","deltaDis","speed","deltaX","Math","cos","deltaY","sin","baseNode","rotation","rad2ang","configData","isOutMap","clearEntity","_onCollisionEnter","other","self","monsterNode","node","onHitBullet","harm"],"mappings":"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","file":"BulletGuidemissile.js","sourceRoot":"../../../../../../../assets/scripts/node/entity/bullet","sourcesContent":["cc.Class({\n    extends:require(\"BulletBase\"),\n    ctor(){\n        this.initDir = cc.v2(1,0);\n        this.curPassIdx = cc.passData.getCurPassIdx();\n    },\n    initGameData(){\n        this._super();\n        this.gameData.curTarget = undefined;\n        this.gameData.launchAng = undefined;\n        this.gameData.nextDir = undefined;\n        this.gameData.nextAng = undefined;\n        this.gameData.goAdjustInterval = 0;\n    },\n    initEntity(idx,target,launchAng){\n        this._super(idx);\n        this.gameData.curTarget = target;\n        this.gameData.launchAng = launchAng;\n        this.updateProperty();\n    },\n    unInitEntity(){\n        this._super();\n    },\n    updateProperty(property){\n        if(!this._super(property)){\n            return false;\n        }\n        return true;\n    },\n    adjustNextDir(dt){\n        if(!this.gameData.curTarget)return;\n        if(this.gameData.goAdjustInterval!=undefined&&\n           this.gameData.goAdjustInterval<this.propValue.adjustInterval){\n            this.gameData.goAdjustInterval += dt;\n            return;\n        }\n        this.gameData.goAdjustInterval = 0;\n        var nextDir = cc.v2(this.gameData.curTarget.x-this.x,this.gameData.curTarget.y-this.y);\n        nextDir.normalizeSelf();\n        this.gameData.nextDir = nextDir;\n\n        this.gameData.nextAng = nextDir.signAngle(this.initDir);\n    },\n    adjustDir(dt){\n        if(!this.gameData.nextDir)return;\n\n        var launchAng = cc.utils.wrapRad_0_2pi(this.gameData.launchAng);\n        var nextAng = cc.utils.wrapRad_0_2pi(this.gameData.nextAng);\n\n        var changeDir = 1;\n        var ang = nextAng - launchAng;\n        if(ang>cc.utils.pi){\n            ang -= cc.utils.pi2;\n        }else if(ang<-cc.utils.pi){\n            ang += cc.utils.pi2;\n        }\n\n        var endAng = launchAng + ang;\n        if(ang < 0)changeDir=-1;\n        launchAng+=changeDir*this.propValue.adjustAng*dt;\n        if(changeDir>0){\n            if(launchAng>endAng)\n                launchAng = endAng;\n        }else{\n            if(launchAng<endAng)\n                launchAng = endAng;\n        }\n\n        this.gameData.launchAng = cc.utils.wrapRad_fpi_zpi(launchAng);\n    },\n    logicUpdate(dt){\n        if(!this.gameData.curTarget||!this.gameData.curTarget.isAlive()){\n            this.gameData.curTarget = cc.entityMgr.getNearEntity(this,\"EntityMonster\");\n        }\n        if(this.moveHelp!=undefined)return;\n\n        this.adjustNextDir(dt);\n        this.adjustDir(dt);\n\n        var deltaDis = this.propValue.speed*dt;\n        var deltaX = deltaDis*Math.cos(this.gameData.launchAng);\n        var deltaY = deltaDis*Math.sin(this.gameData.launchAng);\n        this.x+=deltaX;\n        this.y+=deltaY;\n        /*使用dir1.signAngle(dir2) 求出的角度，当dir2转向dir1时，为正，dir1转\n        向dir2时为负，ps，这个signAngle有时算出的结果不一定在-pi～pi之间，所以在\n        上面计算launchAng时，把角度限制在0～360之间，手动计算步进的正负值，然后再\n        换算到-pi~pi之间，这里计算图形的角度之所以要-90-launchAng，是因为cocos的\n        旋转角是逆时针为负，顺时针为正，和我们求出来的角度顺序刚好相反，所以要对\n        lanuchAng求反，至于为什么这里算出来的lanuchAng为什么不把顺序为cocos搞成\n        一至，因为这个角度要用来计算速度的偏移值的，而这个速度必须与笛卡启尔坐标求正\n        余弦一至。\n        */\n        this.baseNode.rotation = -90-cc.utils.rad2ang(this.gameData.launchAng);\n        if(cc.configData.isOutMap(this.curPassIdx,this)){\n            cc.entityMgr.clearEntity(this);\n        }\n    },\n    _onCollisionEnter(other,self){\n        var monsterNode = other.node;\n        monsterNode.onHitBullet(this);\n        monsterNode.harm(this.propValue.harm);\n        cc.entityMgr.clearEntity(this);\n    },\n})"]}