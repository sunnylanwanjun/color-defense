{"version":3,"sources":["../../../../../assets/scripts/component/assets/scripts/component/LayerGrid.js"],"names":["cc","Class","extends","require","properties","roadNumber","default","undefined","type","EditBox","start","_super","gridHelp","destroy","curPassData","passData","getCurPassData","gameui","resMgr","getRes","resName","node","Node","color","sp","addComponent","Sprite","spriteFrame","getSpriteFrame","parent","active","hoverEntity","globalEvent","on","clearWantPlaceEntityHandle","onDestroy","off","event","mouseHoverHandle","mousePos","wantPlaceEntity","editData","entityType","gridInfo","getGridPos","x","y","mouseDownHandle","placeInfo","configIdx","parseInt","string","newPoint","newBorn","newTarget","newFloor","entityMgr","createEntity","clearWantPlaceEntity"],"mappings":"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","file":"LayerGrid.js","sourceRoot":"../../../../../assets/scripts/component","sourcesContent":["cc.Class({\n    extends:require(\"Grid\"),\n    properties:{\n        roadNumber:{\n            default:undefined,\n            type:cc.EditBox\n        }\n    },\n    start(){\n        this._super();\n        this.gridHelp.destroy();\n        this.gridHelp = undefined;\n        this.curPassData = cc.passData.getCurPassData();\n\n        this.gameui = cc.resMgr.getRes(cc.resName.gameui);\n        var node = new cc.Node();\n        node.color = cc.color(255,0,0);\n        var sp = node.addComponent(cc.Sprite);\n        sp.spriteFrame = this.gameui.getSpriteFrame(\"ui-circle\");\n        node.parent = this.node;\n        node.active = false;\n        this.hoverEntity = node;\n\n        cc.globalEvent.on(\"EditData:clearWantPlaceEntity\",\n        this.clearWantPlaceEntityHandle,this);\n    },\n    onDestroy(){\n        this._super();\n        cc.globalEvent.off(\"EditData:clearWantPlaceEntity\",\n        this.clearWantPlaceEntityHandle,this);\n    },\n    clearWantPlaceEntityHandle(event){\n        this.hoverEntity.active = false;\n    },\n    mouseHoverHandle(mousePos){\n        if(!this._super(mousePos)){\n            return;\n        }\n\n        var wantPlaceEntity = cc.editData.wantPlaceEntity;\n        if(!wantPlaceEntity.entityType){\n            this.hoverEntity.active = false;\n        }else{\n            this.hoverEntity.active = true;\n        }\n\n        var gridInfo = this.getGridPos(mousePos.x,mousePos.y);\n        this.hoverEntity.x = gridInfo.x;\n        this.hoverEntity.y = gridInfo.y;\n    },\n    mouseDownHandle(mousePos){\n        var placeInfo = cc.editData.wantPlaceEntity;\n        var entityType = placeInfo.entityType;\n        var configIdx = placeInfo.configIdx;\n        if(!placeInfo.entityType){\n            return;\n        }\n        \n        var gridInfo = this.getGridPos(mousePos.x,mousePos.y);\n        var x = gridInfo.x;\n        var y = gridInfo.y;\n\n        switch(entityType){\n            case \"EntityPoint\":\n                var roadNumber = parseInt(this.roadNumber.string);\n                cc.editData.newPoint(configIdx,x,y,roadNumber);\n                return;\n            break;\n            case \"EntityBorn\":\n                cc.editData.newBorn(configIdx,x,y);\n            break;\n            case \"EntityTarget\":\n                cc.editData.newTarget(configIdx,x,y);\n            break;\n            case \"EntityFloor\":\n                cc.editData.newFloor(configIdx,x,y);\n                return;\n            break;\n            default:\n                cc.entityMgr.createEntity(entityType,x,y,configIdx);\n            break;\n        }\n\n        cc.editData.clearWantPlaceEntity();\n        this.hoverEntity.active = false;\n    },\n});"]}